<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>デジタル時計</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: black;
        }
        #container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #date {
            width: 400px;
            height: 50px;
            display: flex;
            justify-content: space-between;
            margin-bottom: 35px;
        }
        #clock {
            width: 600px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .digit {
            width: 120px;
            height: 200px;
            position: relative;
        }
        .date-digit {
            width: 40px;
            height: 50px;
            position: relative;
        }
        .colon, .dot {
            width: 20px;
            height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .date-dot {
            width: 10px;
            height: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .colon-dot {
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            margin: 30px 0;
        }
        .date-dot-dot {
            width: 5px;
            height: 5px;
            background-color: orange;
            border-radius: 50%;
            margin: 5px 0;
        }
        .colon.hidden .colon-dot, .dot.hidden .date-dot-dot {
            background-color: #333333;
        }
        .segment {
            fill: white;
            stroke: none;
        }
        .date-segment {
            fill: orange;
            stroke: none;
        }
        .segment.off {
            fill: #333333;
            stroke: none;
        }
        .date-segment.off {
            fill: #333333;
            stroke: none;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="date">
            <div class="date-digit" id="date1"></div>
            <div class="date-digit" id="date2"></div>
            <div class="date-digit" id="date3"></div>
            <div class="date-digit" id="date4"></div>
            <div class="date-dot" id="dot1">
                <div class="date-dot-dot"></div>
            </div>
            <div class="date-digit" id="date5"></div>
            <div class="date-digit" id="date6"></div>
            <div class="date-dot" id="dot2">
                <div class="date-dot-dot"></div>
            </div>
            <div class="date-digit" id="date7"></div>
            <div class="date-digit" id="date8"></div>
        </div>
        <div id="clock">
            <div class="digit" id="digit1"></div>
            <div class="digit" id="digit2"></div>
            <div class="colon" id="colon">
                <div class="colon-dot"></div>
                <div class="colon-dot"></div>
            </div>
            <div class="digit" id="digit3"></div>
            <div class="digit" id="digit4"></div>
        </div>
    </div>

    <script>
        // 時刻用7セグメントSVG（高さ200px、幅120pxにスケール）
        const segmentSVG = (id) => `
            <svg width="120" height="200" viewBox="0 0 100 150" xmlns="http://www.w3.org/2000/svg">
                <!-- セグメントa (上) -->
                <polygon class="segment" id="${id}-a" points="30,10 70,10 60,20 40,20"/>
                <!-- セグメントb (右上) -->
                <polygon class="segment" id="${id}-b" points="70,10 80,20 80,60 70,70 60,60 60,20"/>
                <!-- セグメントc (右下) -->
                <polygon class="segment" id="${id}-c" points="70,80 80,90 80,130 70,140 60,130 60,90"/>
                <!-- セグメントd (下) -->
                <polygon class="segment" id="${id}-d" points="30,140 70,140 60,130 40,130"/>
                <!-- セグメントe (左下) -->
                <polygon class="segment" id="${id}-e" points="20,90 30,80 40,90 40,130 30,140 20,130"/>
                <!-- セグメントf (左上) -->
                <polygon class="segment" id="${id}-f" points="20,20 30,10 40,20 40,60 30,70 20,60"/>
                <!-- セグメントg (中央) -->
                <polygon class="segment" id="${id}-g" points="30,70 70,70 60,80 40,80"/>
            </svg>
        `;

        // 日付用7セグメントSVG（高さ50px、幅40pxにスケール）
        const dateSegmentSVG = (id) => `
            <svg width="40" height="50" viewBox="0 0 100 150" xmlns="http://www.w3.org/2000/svg">
                <!-- セグメントa (上) -->
                <polygon class="date-segment" id="${id}-a" points="30,10 70,10 60,20 40,20"/>
                <!-- セグメントb (右上) -->
                <polygon class="date-segment" id="${id}-b" points="70,10 80,20 80,60 70,70 60,60 60,20"/>
                <!-- セグメントc (右下) -->
                <polygon class="date-segment" id="${id}-c" points="70,80 80,90 80,130 70,140 60,130 60,90"/>
                <!-- セグメントd (下) -->
                <polygon class="date-segment" id="${id}-d" points="30,140 70,140 60,130 40,130"/>
                <!-- セグメントe (左下) -->
                <polygon class="date-segment" id="${id}-e" points="20,90 30,80 40,90 40,130 30,140 20,130"/>
                <!-- セグメントf (左上) -->
                <polygon class="date-segment" id="${id}-f" points="20,20 30,10 40,20 40,60 30,70 20,60"/>
                <!-- セグメントg (中央) -->
                <polygon class="date-segment" id="${id}-g" points="30,70 70,70 60,80 40,80"/>
            </svg>
        `;

        // 7セグメントの表示パターン (0-9)
        const patterns = {
            '0': ['a', 'b', 'c', 'd', 'e', 'f'],
            '1': ['b', 'c'],
            '2': ['a', 'b', 'd', 'e', 'g'],
            '3': ['a', 'b', 'c', 'd', 'g'],
            '4': ['b', 'c', 'f', 'g'],
            '5': ['a', 'c', 'd', 'f', 'g'],
            '6': ['a', 'c', 'd', 'e', 'f', 'g'],
            '7': ['a', 'b', 'c'],
            '8': ['a', 'b', 'c', 'd', 'e', 'f', 'g'],
            '9': ['a', 'b', 'c', 'd', 'f', 'g']
        };

        // SVGを各桁に設定
        ['digit1', 'digit2', 'digit3', 'digit4'].forEach(id => {
            document.getElementById(id).innerHTML = segmentSVG(id.replace('digit', 'd'));
        });
        ['date1', 'date2', 'date3', 'date4', 'date5', 'date6', 'date7', 'date8'].forEach(id => {
            document.getElementById(id).innerHTML = dateSegmentSVG(id);
        });

        // ランダムシャッフル表示（1コマ）
        function shuffleSegments() {
            const segments = ['a', 'b', 'c', 'd', 'e', 'f', 'g'];
            // 時刻のシャッフル
            ['d1', 'd2', 'd3', 'd4'].forEach(digitId => {
                segments.forEach(segment => {
                    const element = document.getElementById(`${digitId}-${segment}`);
                    if (element) {
                        if (Math.random() > 0.5) {
                            element.style.fill = 'white';
                            element.classList.remove('off');
                        } else {
                            element.style.fill = '#333333';
                            element.classList.add('off');
                        }
                    }
                });
            });
            // 日付のシャッフル
            ['date1', 'date2', 'date3', 'date4', 'date5', 'date6', 'date7', 'date8'].forEach(digitId => {
                segments.forEach(segment => {
                    const element = document.getElementById(`${digitId}-${segment}`);
                    if (element) {
                        if (Math.random() > 0.5) {
                            element.style.fill = 'orange';
                            element.classList.remove('off');
                        } else {
                            element.style.fill = '#333333';
                            element.classList.add('off');
                        }
                    }
                });
            });
            // コロンとドットのシャッフル
            document.getElementById('colon').classList.toggle('hidden', Math.random() > 0.5);
            document.getElementById('dot1').classList.toggle('hidden', Math.random() > 0.5);
            document.getElementById('dot2').classList.toggle('hidden', Math.random() > 0.5);
        }

        // 時刻と日付の更新
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const year = String(now.getFullYear());
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const time = hours + minutes;
            const date = year + month + day;

            // 時刻の更新
            ['d1', 'd2', 'd3', 'd4'].forEach((digitId, index) => {
                const digit = time[index];
                const segments = ['a', 'b', 'c', 'd', 'e', 'f', 'g'];
                // 00:00〜09:59のとき、一桁目の「0」を#333で表示
                if (index === 0 && hours < 10 && digit === '0') {
                    segments.forEach(segment => {
                        const element = document.getElementById(`${digitId}-${segment}`);
                        if (element) {
                            element.style.fill = '#333333';
                            element.classList.add('off');
                        }
                    });
                } else {
                    segments.forEach(segment => {
                        const element = document.getElementById(`${digitId}-${segment}`);
                        if (element) {
                            if (patterns[digit].includes(segment)) {
                                element.style.fill = 'white';
                                element.classList.remove('off');
                            } else {
                                element.style.fill = '#333333';
                                element.classList.add('off');
                            }
                        }
                    });
                }
            });

            // 日付の更新
            ['date1', 'date2', 'date3', 'date4', 'date5', 'date6', 'date7', 'date8'].forEach((digitId, index) => {
                const digit = date[index];
                const segments = ['a', 'b', 'c', 'd', 'e', 'f', 'g'];
                segments.forEach(segment => {
                    const element = document.getElementById(`${digitId}-${segment}`);
                    if (element) {
                        if (patterns[digit].includes(segment)) {
                            element.style.fill = 'orange';
                            element.classList.remove('off');
                        } else {
                            element.style.fill = '#333333';
                            element.classList.add('off');
                        }
                    }
                });
            });

            // コロンとドットの点滅
            const colon = document.getElementById('colon');
            const dot1 = document.getElementById('dot1');
            const dot2 = document.getElementById('dot2');
            colon.classList.toggle('hidden');
            dot1.classList.toggle('hidden');
            dot2.classList.toggle('hidden');
        }

        // デバッグ用：初期状態で数字「8」を表示（全セグメント点灯）
        function testDisplay() {
            ['d1', 'd2', 'd3', 'd4'].forEach(digitId => {
                const segments = ['a', 'b', 'c', 'd', 'e', 'f', 'g'];
                segments.forEach(segment => {
                    const element = document.getElementById(`${digitId}-${segment}`);
                    if (element) {
                        element.style.fill = 'white';
                        element.classList.remove('off');
                    }
                });
            });
            ['date1', 'date2', 'date3', 'date4', 'date5', 'date6', 'date7', 'date8'].forEach(digitId => {
                const segments = ['a', 'b', 'c', 'd', 'e', 'f', 'g'];
                segments.forEach(segment => {
                    const element = document.getElementById(`${digitId}-${segment}`);
                    if (element) {
                        element.style.fill = 'orange';
                        element.classList.remove('off');
                    }
                });
            });
        }

        // 初期表示テスト
        testDisplay();

        // シャッフルアニメーションと時計更新
        let clockInterval;
        let shuffleCount = 0;
        const shuffleInterval = setInterval(() => {
            shuffleSegments();
            shuffleCount++;
            if (shuffleCount >= 5) {
                clearInterval(shuffleInterval);
                updateClock();
                clockInterval = setInterval(updateClock, 1000);
            }
        }, 100);

        // アンロード時にクリーンアップ
        window.onunload = () => {
            if (clockInterval) {
                clearInterval(clockInterval);
                console.log('clockIntervalクリア');
            }
        };
    </script>
</body>
</html>